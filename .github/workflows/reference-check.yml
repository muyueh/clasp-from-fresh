name: Reference Check Validation

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  reference-check:
    runs-on: ubuntu-latest
    steps:
      - name: Validate Reference Check section
        uses: actions/github-script@v7
        with:
          script: |
            const body = (context.payload.pull_request.body || '').trim();
            if (!body) {
              core.setFailed('PR body is empty. Please use the pull request template.');
              return;
            }

            const match = body.match(/##\s*Reference Check([\s\S]*)/i);
            if (!match) {
              core.setFailed('Missing "## Reference Check" section in PR body.');
              return;
            }

            const section = match[1].trim();
            if (!section) {
              core.setFailed('The Reference Check section is empty.');
              return;
            }

            const keywordMatches = section.match(/keyword-index\/[^\s,`*]+/gi) || [];
            const fullMatches = section.match(/full-reference\/[^\s,`*]+/gi) || [];

            if (keywordMatches.length === 0) {
              core.setFailed('Reference Check must include at least one keyword-index/*.md entry.');
              return;
            }

            if (fullMatches.length === 0) {
              core.setFailed('Reference Check must include at least one full-reference/*.md entry.');
              return;
            }

            core.info('Reference Check section validated successfully.');
